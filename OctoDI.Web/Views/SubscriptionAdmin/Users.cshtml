@model IEnumerable<OctoDI.Web.Models.DatabaseModels.User>
@{
    ViewData["Title"] = "Users Management";
}

<style>
    /* Container */
    .modern-container {
        max-width: 1200px;
        margin: 2rem auto;
    }

    /* Card */
    .modern-card {
        border-radius: 1rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        background-color: #fff;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }

        .modern-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.08);
        }

    /* Table */
    table th, table td {
        vertical-align: middle;
    }

    table th {
        font-weight: 600;
    }

    /* Buttons */
    .btn-primary {
        border-radius: 0.75rem;
        padding: 0.5rem 1rem;
        font-weight: 600;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        transition: all 0.3s;
    }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
        }

    .btn-outline-primary {
        border-radius: 0.5rem;
        transition: all 0.3s;
    }

        .btn-outline-primary:hover {
            background-color: #667eea;
            color: #fff;
            border-color: #667eea;
        }

    .btn-outline-danger {
        border-radius: 0.5rem;
        transition: all 0.3s;
    }

        .btn-outline-danger:hover {
            background-color: #dc3545;
            color: #fff;
            border-color: #dc3545;
        }

    /* Badges */
    .badge {
        font-weight: 500;
        padding: 0.4rem 0.7rem;
        border-radius: 0.5rem;
        font-size: 0.85rem;
    }

    /* Empty state */
    .empty-state {
        padding: 4rem 0;
        text-align: center;
        color: #6c757d;
    }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

    /* Alerts */
    .alert {
        border-radius: 0.75rem;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    /* Page header */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

        .page-header h2 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            color: #333;
        }
    /* Icon-only action buttons with visible colors */
    .action-icon {
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 2px 4px;
        border-radius: 4px;
        color: inherit; /* inherit from parent for visibility */
    }

        /* Edit icon */
        .action-icon.edit {
            color: #3b49df; /* darker blue for visibility */
        }

            .action-icon.edit:hover {
                color: #764ba2; /* purple on hover */
                transform: scale(1.2);
            }

        /* Delete icon */
        .action-icon.delete {
            color: #c82333; /* darker red */
        }

            .action-icon.delete:hover {
                color: #dc3545; /* bright red on hover */
                transform: scale(1.2);
            }


    
    /* Table row hover */
    table tbody tr:hover {
        background-color: #f8f9fa;
        transition: background-color 0.3s;
    }
</style>

<div class="modern-container">
    @* <!-- Success/Error Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill"></i>
            <strong>Success:</strong> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <strong>Error:</strong> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    } *@

    <!-- Page Header -->
    <div class="page-header">
        <h2><i class="bi bi-people-fill"></i> Employee Management</h2>
        <a asp-action="CreateUser" asp-route-subscriptionId="@ViewBag.SubscriptionId" class="btn btn-primary">
            <i class="bi bi-person-plus"></i> Add New User
        </a>
    </div>

    <!-- Users Table Card -->
    <div class="modern-card">
        @if (Model.Any())
        {
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Full Name</th>
                            <th>Phone</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Created Date</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var user in Model)
                        {
                            <tr>
                                <td>@user.UserId</td>
                                <td><strong>@user.Username</strong></td>
                                <td><i class="bi bi-envelope text-muted"></i> @user.Email</td>
                                <td>@user.FirstName @user.LastName</td>
                                <td>
                                    @if (!string.IsNullOrEmpty(user.PhoneNumber))
                                    {
                                        <i class="bi bi-telephone text-muted"></i> 
                                        @user.PhoneNumber
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td><span class="badge bg-info">@user.UserRole</span></td>
                                <td>
                                    @if (user.IsActive)
                                    {
                                        <span class="badge bg-success">
                                            <i class="bi bi-check-circle"></i> Active
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">
                                            <i class="bi bi-x-circle"></i> Inactive
                                        </span>
                                    }
                                </td>
                                <td><small class="text-muted">@user.CreatedDate.ToString("MMM dd, yyyy")</small></td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-2">
                                        <!-- Edit Icon -->
                                        <a asp-action="EditUser" asp-route-id="@user.UserId" class="action-icon edit" title="Edit">
                                            <i class="bi bi-pencil"></i>
                                        </a>

                                        <!-- Delete Icon -->
                                        <span class="action-icon delete" onclick="confirmDelete(@user.UserId, '@user.Username')" title="Delete">
                                            <i class="bi bi-trash"></i>
                                        </span>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="empty-state">
                <i class="bi bi-inbox"></i>
                <h4 class="mt-3">No Users Found</h4>
                <p>Start by creating your first user.</p>
                <a asp-action="CreateUser" asp-route-subscriptionId="@ViewBag.SubscriptionId" class="btn btn-primary mt-2">
                    <i class="bi bi-person-plus"></i> Add First User
                </a>
            </div>
        }
    </div>
</div>

<!-- Delete Confirmation Form (Hidden) -->
<form id="deleteForm" method="post" asp-action="DeleteUser" style="display: none;">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" id="deleteUserId" />
    <input type="hidden" name="subscriptionId" value="@ViewBag.SubscriptionId" />
</form>

@section Scripts {
    <script>
        function confirmDelete(userId, username) {
            Swal.fire({
                title: `Delete "${username}"?`,
                text: "This action cannot be undone!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#6c757d",
                confirmButtonText: "Yes, delete user",
                cancelButtonText: "Cancel",
                customClass: {
                    popup: 'rounded-4 shadow-lg',
                    title: 'fw-bold',
                    confirmButton: 'btn btn-danger px-4',
                    cancelButton: 'btn btn-secondary px-4'
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('deleteUserId').value = userId;
                    document.getElementById('deleteForm').submit();
                }
            });
        }

        // Optional: show success/error popups from TempData
        @if (TempData["Success"] != null)
        {
                <text>
                    Swal.fire({
                        icon: 'success',
                        title: 'Success!',
                        text: '@TempData["Success"]',
                        timer: 2000,
                        showConfirmButton: false
                    });
                </text>
        }

        @if (TempData["Error"] != null)
        {
                <text>
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: '@TempData["Error"]'
                    });
                </text>
        }
    </script>
}

