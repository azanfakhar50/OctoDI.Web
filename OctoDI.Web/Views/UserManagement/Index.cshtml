@model IEnumerable<OctoDI.Web.Models.ViewModels.UserManagementViewModel>
@{
    ViewData["Title"] = "User Management";
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
    .modern-container {
        padding: 2rem;
        background-color: #f8f9fa;
        min-height: 100vh;
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .modern-card {
        background-color: #ffffff;
        border-radius: 1rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        padding: 1.5rem;
        transition: all 0.3s ease;
    }

        .modern-card:hover {
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.1);
        }

    table.dataTable tbody tr:hover {
        background-color: #f1f3f5;
    }

    .action-icon {
        cursor: pointer;
        margin: 0 0.25rem;
        font-size: 1.1rem;
        transition: color 0.2s;
    }

        .action-icon.edit:hover {
            color: #0d6efd;
        }

        .action-icon.delete:hover {
            color: #dc3545;
        }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
        padding: 0.2rem 0.6rem;
        margin-left: 0.2rem;
        border-radius: 0.35rem;
    }

    .dataTables_wrapper .dataTables_filter input {
        border-radius: 0.35rem;
        padding: 0.3rem 0.5rem;
        border: 1px solid #ced4da;
    }
    /* Modern Pagination for DataTables */
    .dataTables_wrapper .dataTables_paginate {
        margin-top: 1rem;
    }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            border-radius: 0.5rem !important;
            padding: 0.4rem 0.75rem !important;
            margin: 0 0.2rem !important;
            background: #ffffff !important;
            color: #333 !important;
            border: 1px solid #dee2e6 !important;
            transition: 0.2s ease;
        }

            .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
                background: #f1f3f5 !important;
                color: #000 !important;
            }

            /* Active Page */
            .dataTables_wrapper .dataTables_paginate .paginate_button.current {
                background: #0d6efd !important;
                color: #fff !important;
                border: 1px solid #0d6efd !important;
            }

            /* Disabled buttons */
            .dataTables_wrapper .dataTables_paginate .paginate_button.disabled {
                opacity: 0.5 !important;
                pointer-events: none !important;
            }

            /* Remove DataTables focus outline */
            .dataTables_wrapper .dataTables_paginate .paginate_button:focus {
                box-shadow: none !important;
            }

</style>

<div class="modern-container">
    <div class="page-header">
        <h2 class="fw-bold"><i class="bi bi-people-fill me-2"></i> User Management</h2>
        <a asp-controller="UserManagement" asp-action="CreateUser" class="btn btn-primary shadow-sm">
            <i class="bi bi-person-plus me-1"></i> Add New User
        </a>
    </div>

    <div class="modern-card">
        <div class="table-responsive">
            <table id="usersTable" class="table table-hover align-middle display nowrap" style="width:100%">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Email</th>
                        <th>Full Name</th>
                        <th>Phone</th>
                        <th>Role</th>
                        <th>Subscription</th>
                        <th>Company</th>
                        <th>Status</th>
                        <th>Created Date</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var user in Model)
                    {
                        <tr>
                            <td>@user.UserId</td>
                            <td>@user.Username</td>
                            <td>@user.Email</td>
                            <td>@user.FirstName @user.LastName</td>
                            <td>@(string.IsNullOrEmpty(user.PhoneNumber) ? "-" : user.PhoneNumber)</td>
                            <td>@user.UserRole</td>
                            <td>@user.SubscriptionType</td>
                            <td>@user.CompanyName</td>
                            <td>
                                <span class="badge @(user.IsActive ? "bg-success" : "bg-secondary")">
                                    @(user.IsActive ? "Active" : "Inactive")
                                </span>
                            </td>
                            <td>@user.CreatedDate.ToString("MMM dd, yyyy")</td>
                            <td class="text-center">
                                <a asp-controller="UserManagement" asp-action="EditUser" asp-route-id="@user.UserId"
                                   class="action-icon edit" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </a>

                                <span class="action-icon delete" onclick="confirmDelete(@user.UserId, '@user.Username')" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<form id="deleteForm" method="post" asp-controller="UserManagement" asp-action="DeleteUser" style="display:none;">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" id="deleteUserId" />
</form>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        $(document).ready(function () {
            $('#usersTable').DataTable({
                responsive: true,
                pageLength: 10,
                lengthMenu: [10, 25, 50, 100],
                columnDefs: [
                    { orderable: false, targets: -1 }
                ]
            });
        });

        function confirmDelete(userId, username) {
            Swal.fire({
                title: `Delete "${username}"?`,
                text: "This action cannot be undone!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#6c757d",
                confirmButtonText: "Yes, delete user",
                cancelButtonText: "Cancel",
            }).then((result) => {
                if (result.isConfirmed) {
                    document.getElementById('deleteUserId').value = userId;
                    document.getElementById('deleteForm').submit();
                }
            });
        }

        @* TempData popups *@
        @if (TempData["Success"] != null)
        {
                <text>
                    Swal.fire(
                        icon: 'success',
                        title: 'Success!',
                        text: '@TempData["Success"]',
                        timer: 2000,
                        showConfirmButton: false
                    );
                </text>
        }

        @if (TempData["Error"] != null)
        {
                <text>
                    Swal.fire(
                        icon: 'error',
                        title: 'Error!',
                        text: '@TempData["Error"]'
                    );
                </text>
        }
    </script>
}
